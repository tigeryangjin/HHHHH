SELECT A.POSTING_DATE_KEY,
       A.MEMBER_KEY,
       COUNT(DISTINCT A.ORDER_KEY) ORDER_COUNT
  FROM FACT_GOODS_SALES A
 WHERE A.POSTING_DATE_KEY >=
       TO_CHAR(TRUNC(&IN_POSTING_DATE - 181), 'YYYYMMDD') /*180天数据统计*/
   AND A.ORDER_STATE = 1
   AND A.TRAN_TYPE = 0
 GROUP BY A.POSTING_DATE_KEY, A.MEMBER_KEY
HAVING COUNT(DISTINCT A.ORDER_KEY) >= 4

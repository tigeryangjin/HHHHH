/*
1-8月浏览过226570 V6无线电动工具升级套装3.0版  的用户
*/
--订购
CREATE TABLE YANGJIN.FACT_GOOD_PAGE_VIEW_TMP AS
SELECT *
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY BETWEEN 20180101 AND 20180831
   AND A.PAGE_NAME IN ('good', 'Good')
   AND A.MEMBER_KEY <> 0;

SELECT DISTINCT A.MEMBER_KEY
  FROM YANGJIN.FACT_GOOD_PAGE_VIEW_TMP A
 WHERE A.PAGE_VALUE = '164578';

/*
1年内订购过  御泥坊   商品用户
*/
--订购
SELECT F.MEMBER_BP
  FROM (SELECT TO_NUMBER(A.CUST_NO) MEMBER_BP,
               COUNT(DISTINCT A.ORDER_ID) ORDER_CNT
          FROM FACT_EC_ORDER_2 A, FACT_EC_ORDER_GOODS B
         WHERE A.ORDER_ID = B.ORDER_ID
           AND A.ADD_TIME BETWEEN DATE '2017-09-01' AND DATE
         '2018-08-31'
           AND A.ORDER_STATE >= 20
           AND A.CUST_NO <> 0
           AND EXISTS
         (SELECT 1
                  FROM (SELECT D.GOODS_COMMONID
                          FROM DIM_EC_GOOD D
                         WHERE D.BRAND_NAME = '御泥坊') C
                 WHERE B.GOODS_COMMONID = C.GOODS_COMMONID)
         GROUP BY A.CUST_NO) F
 ORDER BY F.MEMBER_BP;


--tmp
SELECT * FROM DIM_GOOD A WHERE A.ITEM_CODE = 226570;
SELECT * FROM DIM_GOOD_CLASS A WHERE A.MATDLT LIKE '%服%';
SELECT * FROM DIM_GOOD_CLASS A WHERE A.MATZLT LIKE '%服%';
SELECT * FROM DIM_GOOD_CLASS A WHERE A.MATXLT LIKE '%服%';
SELECT * FROM DIM_GOOD_CLASS A WHERE A.Matklt LIKE '%服%';

SELECT * FROM DIM_GOOD_CLASS A ORDER BY A.MATDL, A.MATZL, A.MATXL, A.MATKL;

/*
12月3-7日未登录过的黄金及以上用户的BP号和会员等级
*/
SELECT A.MEMBER_BP, A.MEMBER_LEVEL
  FROM DIM_MEMBER A
 WHERE A.MEMBER_LEVEL IN ('HAPP_T3', 'HAPP_T4', 'HAPP_T5', 'HAPP_T6')
   AND NOT EXISTS
 (SELECT 1
          FROM (SELECT DISTINCT C.MEMBER_KEY
                  FROM FACT_PAGE_VIEW C
                 WHERE C.VISIT_DATE_KEY BETWEEN 20181203 AND 20181207
                   AND C.MEMBER_KEY <> 0) B
         WHERE A.MEMBER_BP = B.MEMBER_KEY)
   AND EXISTS
 (SELECT 1 FROM FACT_ECMEMBER D WHERE A.MEMBER_BP = D.MEMBER_CRMBP)
 ORDER BY A.MEMBER_BP;

SELECT * FROM FACT_ECMEMBER;

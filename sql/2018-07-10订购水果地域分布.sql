--去年6月到今年6月底为止，在我们电商渠道（20017、20020、20021、20023）的订购水果（三级分类）的订单的地域分布                 
--表结构（省、市、订购人数、订购件数、订购金额）
SELECT E.VTEXT1,
       E.VTEXT2,
       SUM(D.MEMBER_COUNT) MEMBER_COUNT,
       SUM(D.ORDER_QTY) ORDER_QTY,
       SUM(D.ORDER_AMOUNT) ORDER_AMOUNT
  FROM (SELECT A.ADDRESS_KEY,
               COUNT(DISTINCT A.MEMBER_KEY) MEMBER_COUNT,
               SUM(B.NUMS) ORDER_QTY,
               SUM(B.ORDER_AMOUNT) ORDER_AMOUNT
          FROM FACT_ORDER A, FACT_GOODS_SALES B
         WHERE A.ORDER_KEY = B.ORDER_KEY
           AND A.POSTING_DATE_KEY BETWEEN 20170601 AND 20180630
           AND A.SALES_SOURCE_SECOND_KEY IN (20017, 20020, 20021, 20023)
              /*AND EXISTS (SELECT 1
               FROM DIM_GOOD C
              WHERE C.MATL_GROUP = 51060202
                AND B.GOODS_COMMON_KEY = C.ITEM_CODE)*/
           AND EXISTS (SELECT 1
                  FROM DIM_EC_GOOD F
                 WHERE B.GOODS_COMMON_KEY = F.ITEM_CODE
                   AND F.MATKL = 51060202
                   AND F.IS_SHIPPING_SELF = 1)
         GROUP BY A.ADDRESS_KEY) D,
       DIM_ZONE E
 WHERE D.ADDRESS_KEY = E.ZONE1_4
 GROUP BY E.VTEXT1, E.VTEXT2
 ORDER BY SUM(D.ORDER_AMOUNT) DESC;

--51060202
SELECT * FROM DIM_GOOD_CLASS A WHERE A.MATKLT LIKE '%水果%';
SELECT * FROM DIM_GOOD A WHERE A.MATL_GROUP = 51060202;
SELECT * FROM DIM_EC_GOOD A;
SELECT * FROM ALL_COL_COMMENTS A WHERE A.COLUMN_NAME LIKE '%ADDRESS_KEY%';
SELECT * FROM DIM_ZONE;
SELECT * FROM DIM_ZONE_GX;

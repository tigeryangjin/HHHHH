SELECT A.DATE_KEY,
       A.ORDER_VID_COUNT,
       B.NON_SCAN_VID_COUNT,
       ROUND(A.ORDER_VID_COUNT / B.NON_SCAN_VID_COUNT, 4) CVR,
       SYSDATE W_INSERT_DT,
       SYSDATE W_UPDATE_DT
  FROM (SELECT A1.ADD_TIME DATE_KEY, COUNT(DISTINCT A1.VID) ORDER_VID_COUNT
          FROM FACTEC_ORDER A1
         WHERE A1.APP_NAME = 'KLGWX'
           AND A1.ORDER_FROM != 76
           AND A1.STORE_ID = 1
           AND A1.ADD_TIME BETWEEN &V_MONTH_FIRST_DATE_KEY AND &IN_DATE_KEY
           AND A1.CANCEL_BEFORE_STATE = 0
           AND A1.CRM_ORDER_NO > 0
         GROUP BY A1.ADD_TIME) A,
       (SELECT B1.START_DATE_KEY DATE_KEY,
               COUNT(DISTINCT B1.VID) NON_SCAN_VID_COUNT
          FROM FACT_SESSION B1
         WHERE B1.START_DATE_KEY BETWEEN &V_MONTH_FIRST_DATE_KEY AND
               &IN_DATE_KEY
           AND B1.APPLICATION_KEY = 50
           AND B1.VID NOT IN
               (SELECT VID
                  FROM DIM_VID_SCAN
                 WHERE SCAN_DATE_KEY BETWEEN &V_MONTH_FIRST_DATE_KEY AND
                       &IN_DATE_KEY)
         GROUP BY B1.START_DATE_KEY) B
 WHERE A.DATE_KEY = B.DATE_KEY

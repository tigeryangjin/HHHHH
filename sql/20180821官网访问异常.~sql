/*
processstatvtminute5
processstatvtminute
processstatvtminute30
*/
SELECT * FROM stats_online_visitor_minute;
SELECT * FROM DW_HAPPIGO.STATS_ONLINE_VISITOR_MINUTE@BIODS_LINK;
--1.
SELECT A.APPLICATION_KEY, A.APPLICATION_NAME, COUNT(1)
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
   AND TO_CHAR(VISIT_DATE, 'HH24') = '13'
 GROUP BY A.APPLICATION_KEY, A.APPLICATION_NAME;
--2.
SELECT A.APPLICATION_KEY, A.APPLICATION_NAME, COUNT(1)
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
   AND TO_CHAR(VISIT_DATE, 'HH24MI') BETWEEN 1315 AND 1320
 GROUP BY A.APPLICATION_KEY, A.APPLICATION_NAME;
--3.
SELECT A.PAGE_NAME, COUNT(1) PV
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
   AND TO_CHAR(VISIT_DATE, 'HH24MI') BETWEEN 1315 AND 1320
   AND A.APPLICATION_KEY = 40
 GROUP BY A.PAGE_NAME
 ORDER BY COUNT(1) DESC;
--4.
SELECT *
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
   AND TO_CHAR(VISIT_DATE, 'HH24MI') BETWEEN 1315 AND 1320
   AND A.APPLICATION_KEY = 40
   AND A.PAGE_NAME = 'Home';

--5.
SELECT A.VID, COUNT(1)
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
   AND TO_CHAR(VISIT_DATE, 'HH24MI') BETWEEN 1315 AND 1320
   AND A.APPLICATION_KEY = 40
   AND A.PAGE_NAME = 'Home'
 GROUP BY A.VID
 ORDER BY COUNT(1) DESC;

--6.
SELECT A.IP, COUNT(1)
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
   AND TO_CHAR(VISIT_DATE, 'HH24MI') BETWEEN 1315 AND 1320
   AND A.APPLICATION_KEY = 40
   AND A.PAGE_NAME = 'Home'
 GROUP BY A.IP
 ORDER BY COUNT(1) DESC;

--7.
SELECT SUBSTR(A.IP, 1, INSTR(A.IP, '.', 1, 3) - 1) net, count(1)
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
   AND TO_CHAR(VISIT_DATE, 'HH24MI') BETWEEN 1315 AND 1320
   AND A.APPLICATION_KEY = 40
   AND A.PAGE_NAME = 'Home'
 GROUP BY SUBSTR(A.IP, 1, INSTR(A.IP, '.', 1, 3) - 1)
 ORDER BY COUNT(1) DESC;

--8.
SELECT A.IP, count(1)
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
   AND TO_CHAR(VISIT_DATE, 'HH24MI') BETWEEN 1315 AND 1320
   AND A.APPLICATION_KEY = 40
   AND A.PAGE_NAME = 'Home'
   AND SUBSTR(A.IP, 1, INSTR(A.IP, '.', 1, 3) - 1) IN
       ('111.206.221', '111.206.198')
 GROUP BY A.IP
 ORDER BY COUNT(1) DESC;

--9.
SELECT A.PAGE_NAME, COUNT(1)
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
      --AND TO_CHAR(VISIT_DATE, 'HH24MI') BETWEEN 1315 AND 1320
      --AND A.APPLICATION_KEY = 40
      --AND A.PAGE_NAME = 'Home'
   AND SUBSTR(A.IP, 1, INSTR(A.IP, '.', 1, 3) - 1) IN
       ('111.206.221', '111.206.198')
 GROUP BY A.PAGE_NAME
 ORDER BY COUNT(1) DESC;

--10.
SELECT A.VISIT_DATE_KEY, A.PAGE_NAME, COUNT(1)
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY BETWEEN 20180801 AND 20180821
      --AND TO_CHAR(VISIT_DATE, 'HH24MI') BETWEEN 1315 AND 1320
      --AND A.APPLICATION_KEY = 40
      --AND A.PAGE_NAME = 'Home'
   AND SUBSTR(A.IP, 1, INSTR(A.IP, '.', 1, 3) - 1) IN
       ('111.206.221', '111.206.198')
 GROUP BY A.VISIT_DATE_KEY, A.PAGE_NAME
 ORDER BY A.VISIT_DATE_KEY, COUNT(1) DESC;

--11.
SELECT *
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
   AND TO_CHAR(VISIT_DATE, 'HH24MI') BETWEEN 1315 AND 1320;

--12.
SELECT *
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY = 20180820
   AND SUBSTR(A.IP, 1, INSTR(A.IP, '.', 1, 3) - 1) IN
       ('111.206.221', '111.206.198')
   AND A.PAGE_NAME = 'Good';
	 
--13.


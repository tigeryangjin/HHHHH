UPDATE PUSH_MSG_LOG_TMP A
   SET A.MEMBER_BP =
       (SELECT B.MEMBER_KEY
          FROM DIM_MAPPING_MEM B
         WHERE A.SEND_MEMBER = B.OPEN_ID)
 WHERE A.TASK_TYPE = 1
   AND A.MEMBER_BP IS NULL
   AND EXISTS
 (SELECT 1 FROM DIM_MAPPING_MEM C WHERE A.SEND_MEMBER = C.OPEN_ID);

UPDATE PUSH_MSG_LOG_TMP A
   SET A.MEMBER_BP =
       (SELECT B.MEMBER_KEY
          FROM (SELECT C.MEMBER_KEY,
                       C.OPEN_ID,
                       ROW_NUMBER() OVER(PARTITION BY C.OPEN_ID ORDER BY C.CREATE_DATE_KEY DESC) RANK1
                  FROM DIM_MAPPING_MEM C) B
         WHERE A.SEND_MEMBER = B.OPEN_ID
           AND B.RANK1 = 1)
 WHERE A.TASK_TYPE = 1
   AND A.MEMBER_BP IS NULL
   AND EXISTS (SELECT 1
          FROM (SELECT E.MEMBER_KEY,
                       E.OPEN_ID,
                       ROW_NUMBER() OVER(PARTITION BY E.OPEN_ID ORDER BY E.CREATE_DATE_KEY DESC) RANK1
                  FROM DIM_MAPPING_MEM E) D
         WHERE A.SEND_MEMBER = D.OPEN_ID
           AND D.RANK1 = 1);


UPDATE PUSH_MSG_LOG_TMP A SET A.MEMBER_BP = NULL WHERE A.TASK_TYPE=1 ; 

SELECT *
  FROM PUSH_MSG_LOG_TMP A
 WHERE A.TASK_TYPE = 1
   AND A.MEMBER_BP IS NULL
   AND A.SEND_MEMBER = 'oeNKjjjrE5vsSuu8kbeKDylD7OtY';

SELECT E.OPEN_ID, COUNT(1)
  FROM (SELECT D.OPEN_ID
          FROM (SELECT B.OPEN_ID,
                       RANK() OVER(PARTITION BY B.OPEN_ID ORDER BY B.CREATE_DATE_KEY DESC) RANK1
                  FROM DIM_MAPPING_MEM B
                 /*WHERE EXISTS (SELECT 1
                          FROM (SELECT A.SEND_MEMBER OPEN_ID
                                  FROM PUSH_MSG_LOG_TMP A
                                 WHERE A.TASK_TYPE = 1
                                   AND A.MEMBER_BP IS NULL) C
                         WHERE B.OPEN_ID = C.OPEN_ID)*/) D
         WHERE D.RANK1 = 1) E
 GROUP BY E.OPEN_ID
 HAVING COUNT(1)>1;

SELECT *
  FROM DIM_MAPPING_MEM A
 WHERE A.OPEN_ID = 'oeNKjjlwL-hoNH5FniMQOLMXcmnA';
SELECT *
  FROM (SELECT C.MEMBER_KEY,
               C.OPEN_ID,
               ROW_NUMBER() OVER(PARTITION BY C.OPEN_ID ORDER BY C.CREATE_DATE_KEY DESC) RANK1
          FROM DIM_MAPPING_MEM C) D
 WHERE D.OPEN_ID = 'oeNKjjlwL-hoNH5FniMQOLMXcmnA';

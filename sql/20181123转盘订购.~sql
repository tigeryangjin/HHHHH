--1.
TRUNCATE TABLE YANGJIN.MEMBER_TMP;
SELECT * FROM YANGJIN.MEMBER_TMP FOR UPDATE;

--2.
SELECT COUNT(1) FROM YANGJIN.MEMBER_TMP;

--3.订购人数、转化率、订购金额、客单价、件单价
SELECT COUNT(DISTINCT C.CUST_NO) 订购人数,
       SUM(C.ORDER_AMOUNT) 订购金额,
       SUM(C.ORDER_AMOUNT) / COUNT(DISTINCT C.CUST_NO) 客单价,
       SUM(C.ORDER_AMOUNT) / SUM(C.ORDER_QTY) 件单价
  FROM (SELECT A.ORDER_ID,
               A.CUST_NO,
               B.GOODS_COMMONID,
               B.GOODS_NUM ORDER_QTY,
               B.GOODS_PRICE * B.GOODS_NUM ORDER_AMOUNT
          FROM FACT_EC_ORDER_2 A, FACT_EC_ORDER_GOODS B
         WHERE A.ORDER_ID = B.ORDER_ID
           AND A.ORDER_STATE >= 20
           AND A.ADD_TIME BETWEEN DATE '2018-11-21' AND DATE
         '2018-11-24'
           AND EXISTS
         (SELECT 1
                  FROM YANGJIN.MEMBER_TMP D
                 WHERE TO_NUMBER(A.CUST_NO) = D.MEMBER_KEY)) C;

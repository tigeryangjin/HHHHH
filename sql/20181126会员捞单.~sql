/*
2018Äê¶©¹º¹ýÑòÄÌµÄÓÃ»§
*/
--¶©¹º
SELECT F.MEMBER_BP, F.ORDER_CNT
  FROM (SELECT TO_NUMBER(A.CUST_NO) MEMBER_BP,
               COUNT(DISTINCT A.ORDER_ID) ORDER_CNT
          FROM FACT_EC_ORDER_2 A, FACT_EC_ORDER_GOODS B
         WHERE A.ORDER_ID = B.ORDER_ID
           AND A.ADD_TIME BETWEEN DATE '2018-01-01' AND DATE
         '2018-12-31'
           AND A.ORDER_STATE >= 20
           AND A.CUST_NO <> 0
           AND EXISTS
         (SELECT 1
                  FROM (SELECT D.GOODS_COMMONID
                          FROM DIM_EC_GOOD D
                         WHERE D.GC_ID = 1093
                           AND D.GOODS_NAME LIKE '%ÑòÄÌ%') C
                 WHERE B.GOODS_COMMONID = C.GOODS_COMMONID)
         GROUP BY A.CUST_NO) F
--WHERE F.ORDER_CNT >= 2
 ORDER BY F.ORDER_CNT DESC;

--TMP
SELECT * FROM DIM_GOOD A WHERE A.GOODS_NAME LIKE '%Ö±ÓÊ%';
select * from FACT_PAGE_VIEW t WHERE T.VISIT_DATE_KEY >= 20181101;
select DISTINCT T.APPLICATION_KEY, T.APPLICATION_NAME
  from FACT_PAGE_VIEW SUBPARTITION(FPV201811) t
 WHERE T.VISIT_DATE_KEY >= 20181115;
SELECT * FROM DIM_EC_GOOD A WHERE A.GOODS_NAME LIKE '%ÑòÄÌ%';
SELECT * FROM DIM_EC_GOOD A WHERE A.GOODS_NAME LIKE '%´Ìâ¬×ÏÌ´%';
SELECT * FROM DIM_GOOD_CLASS A WHERE A.MATDLT LIKE '%ÑòÄÌ%';
SELECT * FROM DIM_GOOD_CLASS A WHERE A.MATZLT LIKE '%ÑòÄÌ%';
SELECT * FROM DIM_GOOD_CLASS A WHERE A.MATXLT LIKE '%ÑòÄÌ%';
SELECT * FROM DIM_GOOD_CLASS A WHERE A.Matklt LIKE '%ÑòÄÌ%';

SELECT * FROM DIM_EC_GOOD A WHERE A.MATKL = 54030201;
SELECT * FROM DIM_GOOD_CLASS A WHERE A.MATKL = 54030201;
SELECT *
  FROM DIM_EC_GOOD D, DIM_GOOD_CLASS E
 WHERE D.MATKL = E.MATKL
   AND E.MATKL = 54030201;

TRUNCATE TABLE YANGJIN.ITEM_CODE_TMP;
SELECT * FROM YANGJIN.ITEM_CODE_TMP FOR UPDATE;

SELECT F.MEMBER_BP, F.ORDER_CNT
  FROM (SELECT TO_NUMBER(A.CUST_NO) MEMBER_BP,
               COUNT(DISTINCT A.ORDER_ID) ORDER_CNT
          FROM FACT_EC_ORDER_2 A, FACT_EC_ORDER_GOODS B
         WHERE A.ORDER_ID = B.ORDER_ID
           AND A.ADD_TIME BETWEEN DATE '2018-01-01' AND DATE
         '2018-12-31'
           AND A.ORDER_STATE >= 20
           AND A.CUST_NO <> 0
           AND EXISTS
         (SELECT 1
                  FROM YANGJIN.ITEM_CODE_TMP C
                 WHERE B.GOODS_COMMONID = C.GOODS_COMMONID)
         GROUP BY A.CUST_NO) F
--WHERE F.ORDER_CNT >= 2
 ORDER BY F.ORDER_CNT DESC;

SELECT TRUNC(A.ADD_TIME), COUNT(1)
  FROM FACT_EC_ORDER_2 A
 GROUP BY TRUNC(A.ADD_TIME)
 ORDER BY TRUNC(A.ADD_TIME);

SELECT * FROM DIM_EC_GOOD A WHERE A.ITEM_CODE IN (222137, 234654, 215542);
SELECT * FROM DIM_GOOD A WHERE A.ITEM_CODE IN (222137, 234654, 215542);

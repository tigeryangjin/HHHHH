SELECT *
  FROM W_ETL_LOG A
 WHERE EXISTS (SELECT 1
          FROM S_PARAMETERS2 B
         WHERE A.PROC_NAME = B.PNAME
           AND UPPER(B.DEVELOPER) = 'YANGJIN')
   AND A.ETL_DURATION >= 1000
 ORDER BY A.ETL_DURATION DESC;

SELECT *
  FROM W_ETL_LOG A
 WHERE A.PROC_NAME = 'YANGJIN_PKG.OPER_PRODUCT_DAILY_PREVIEW'
 ORDER BY A.START_TIME DESC;

SELECT *
  FROM W_ETL_LOG A
 WHERE A.PROC_NAME IN
       ('YANGJIN_PKG.DATA_ACQUISITION_ITEM_BASE',
        'YANGJIN_PKG.DATA_ACQUISITION_ITEM_CURRENT',
        'YANGJIN_PKG.DATA_ACQUISITION_ITEM_MIN_PER',
        'YANGJIN_PKG.DATA_ACQUISITION_MONTH_NEW',
        'YANGJIN_PKG.DATA_ACQUISITION_MONTH_TOPN',
        'YANGJIN_PKG.DATA_ACQUISITION_WEEK_NEW',
        'YANGJIN_PKG.DATA_ACQUISITION_WEEK_TOPN')
 ORDER BY A.PROC_NAME, A.START_TIME DESC;

SELECT A.PERIOD,
       A.MATDLT,
       A.MATZLT,
       A.MATXLT,
       A.ACQ_ITEM_CODE,
       A.ACQ_NAME,
       A.ACQ_URL,
       A.ACQ_PIC,
       A.ACQ_SHOP_NAME,
       A.ACQ_PRICE,
       A.ACQ_SALES - LAG(A.ACQ_SALES, 1, 0) OVER(PARTITION BY A.ACQ_ITEM_CODE ORDER BY A.PERIOD) CURRENT_ACQ_SALES,
       A.SALES_AMT - LAG(A.SALES_AMT, 1, 0) OVER(PARTITION BY A.ACQ_ITEM_CODE ORDER BY A.PERIOD) CURRENT_SALES_AMT
  FROM DATA_ACQUISITION_ITEM_BASE A
 WHERE A.PERIOD BETWEEN
       TO_CHAR(TO_DATE(&I_DATE_KEY, 'YYYYMMDD') - 4, 'YYYYMMDD') AND
       TO_CHAR(TO_DATE(&I_DATE_KEY, 'YYYYMMDD'), 'YYYYMMDD');

SELECT /*+INDEX(A DATA_ACQUISITION_ITEM_I1)*/
 A.PERIOD,
 A.MATDLT,
 A.MATZLT,
 A.MATXLT,
 A.ACQ_ITEM_CODE,
 A.ACQ_NAME,
 A.ACQ_URL,
 A.ACQ_PIC,
 A.ACQ_SHOP_NAME,
 A.ACQ_PRICE,
 A.ACQ_SALES,
 A.SALES_AMT,
 ROW_NUMBER() OVER(PARTITION BY A.PERIOD, A.ACQ_ITEM_CODE ORDER BY A.DATA_SOURCE, A.PERIOD, A.ACQ_CATEGORY_NAME, A.MATDLT, A.MATZLT, A.MATXLT, A.ACQ_ITEM_CODE, A.ACQ_NAME, A.ACQ_URL, A.ACQ_PIC, A.ACQ_SHOP_NAME, A.ACQ_PRICE, A.ACQ_SALES, A.SALES_AMT, A.INSERT_DATE, A.VALID_FLAG) RN
  FROM DATA_ACQUISITION_ITEM A
 WHERE A.PERIOD = &I_DATE_KEY
   AND A.ACQ_ITEM_CODE IS NOT NULL
   AND A.PERIOD IS NOT NULL;

SELECT * FROM W_ETL_LOG A WHERE A.PROC_NAME LIKE '%TABLE_OPTIMIZATION%';

SELECT /*+INDEX(A DATA_ACQUISITION_CUR_I1)*/
 A.PERIOD, /*日期*/
 A.MATDLT, /*大类名称*/
 A.MATZLT, /*中类名称*/
 A.MATXLT, /*小类名称*/
 A.ACQ_ITEM_CODE, /*商品编码*/
 A.ACQ_NAME, /*商品名称*/
 A.ACQ_URL, /*商品URL地址*/
 A.ACQ_PIC, /*商品图片地址*/
 A.ACQ_SHOP_NAME, /*商铺名称*/
 A.ACQ_PRICE, /*商品售价*/
 A.CURRENT_ACQ_SALES, /*销售数量*/
 A.CURRENT_SALES_AMT /*销售金额*/
  FROM DATA_ACQUISITION_ITEM_CURRENT A
 WHERE A.PERIOD = &I_DATE_KEY
      /*剔除销售数量或者销售金额<=0*/
   AND A.CURRENT_ACQ_SALES > 0
   AND A.CURRENT_SALES_AMT > 0;

SELECT A.PERIOD, /*日期*/
       A.MATDLT, /*大类名称*/
       A.MATZLT, /*中类名称*/
       A.MATXLT, /*小类名称*/
       A.ACQ_ITEM_CODE, /*商品编码*/
       A.ACQ_NAME, /*商品名称*/
       A.ACQ_URL, /*商品URL地址*/
       A.ACQ_PIC, /*商品图片地址*/
       A.ACQ_SHOP_NAME, /*商铺名称*/
       A.ACQ_PRICE, /*商品售价*/
       A.CURRENT_ACQ_SALES, /*销售数量*/
       A.CURRENT_SALES_AMT /*销售金额*/
  FROM DATA_ACQUISITION_ITEM_CURRENT A
 WHERE A.PERIOD = &I_DATE_KEY
      /*剔除销售数量或者销售金额<=0*/
   AND A.CURRENT_ACQ_SALES > 0
   AND A.CURRENT_SALES_AMT > 0;

SELECT A.PERIOD,
       A.MATDLT,
       A.MATZLT,
       A.MATXLT,
       A.ACQ_ITEM_CODE,
       A.ACQ_NAME,
       A.ACQ_URL,
       A.ACQ_PIC,
       A.ACQ_SHOP_NAME,
       A.ACQ_PRICE,
       A.ACQ_SALES,
       A.SALES_AMT,
       ROW_NUMBER() OVER(PARTITION BY A.PERIOD, A.ACQ_ITEM_CODE ORDER BY A.DATA_SOURCE, A.PERIOD, A.ACQ_CATEGORY_NAME, A.MATDLT, A.MATZLT, A.MATXLT, A.ACQ_ITEM_CODE, A.ACQ_NAME, A.ACQ_URL, A.ACQ_PIC, A.ACQ_SHOP_NAME, A.ACQ_PRICE, A.ACQ_SALES, A.SALES_AMT, A.INSERT_DATE, A.VALID_FLAG) RN
  FROM DATA_ACQUISITION_ITEM A
 WHERE A.PERIOD = &I_DATE_KEY
   AND A.ACQ_ITEM_CODE IS NOT NULL
   AND A.PERIOD IS NOT NULL;

BEGIN
  YJ_OPTIMIZATION.ALTER_TABLE_SHRINK_SPACE('DATA_ACQUISITION_ITEM');
END;
/

  SELECT B.PERIOD, COUNT(1)
    FROM (SELECT DISTINCT A.PERIOD, A.ACQ_ITEM_CODE
            FROM DATA_ACQUISITION_ITEM A
           WHERE A.PERIOD >= 20180601) B
   GROUP BY B.PERIOD;

SELECT B.PERIOD, COUNT(1)
  FROM (SELECT DISTINCT A.PERIOD, A.ACQ_ITEM_CODE
          FROM DATA_ACQUISITION_ITEM_BASE A
         WHERE A.PERIOD >= 20180601) B
 GROUP BY B.PERIOD;

SELECT * FROM DATA_ACQUISITION_ITEM_BASE A WHERE A.PERIOD = 20180702;

SELECT *
  FROM W_ETL_LOG A
 WHERE A.PROC_NAME LIKE 'YANGJIN_PKG.DATA_ACQUISITION%'
 ORDER BY A.START_TIME DESC;

SELECT *
  FROM W_ETL_LOG A
 WHERE A.PROC_NAME = 'YANGJIN_PKG.DATA_ACQUISITION_WEEK_TOPN'
 ORDER BY A.START_TIME DESC;

SELECT * FROM OPER_ACTIVE_MEMBER_REPORT;
SELECT * FROM OPER_MEMBER_SOURCE_REPORT;
SELECT * FROM KPI_ASMT_REPURCHASE_MEMBER;
SELECT * FROM OPER_MEMBER_REPURCHASE_RPT_V;

/*
OPER_ACTIVE_MEMBER_REPORT(活跃会员池，会员池目标拆解)
OPER_MEMBER_SOURCE_REPORT(纳新来源)
KPI_ASMT_REPURCHASE_MEMBER(老会员次月重构)
OPER_MEMBER_REPURCHASE_RPT_V(订购频次)
*/

SELECT *
  FROM ALL_SOURCE A
 WHERE UPPER(A.TEXT) LIKE '%OPER_ACTIVE_MEMBER_REPORT%';

SELECT *
  FROM W_ETL_LOG A
 WHERE A.PROC_NAME = 'YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT'
 ORDER BY A.START_TIME DESC;

BEGIN
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20170201);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20170301);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20170401);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20170501);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20170601);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20170701);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20170801);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20170901);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20171001);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20171101);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20171201);
  YJ_REPORT.OPER_ACTIVE_MEMBER_REPORT_P(20180101);
END;

BEGIN
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20170201);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20170301);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20170401);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20170501);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20170601);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20170701);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20170801);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20170901);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20171001);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20171101);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20171201);
  YJ_REPORT.OPER_MEMBER_SOURCE_REPORT_P(20180101);
END;

BEGIN
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20170201);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20170301);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20170401);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20170501);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20170601);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20170701);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20170801);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20170901);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20171001);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20171101);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20171201);
  YJ_REPORT.OPER_MEMBER_REPUR_RRT_P(20180101);
END;

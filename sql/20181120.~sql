--1.
SELECT A.TABLE_NAME,
       A.NUM_ROWS,
       A.AVG_ROW_LEN * A.NUM_ROWS / 1024 / 1024 / 0.9 NEED,
       A.BLOCKS * 8 / 1024 TRUE,
       (A.BLOCKS * 8 / 1024 -
       A.AVG_ROW_LEN * A.NUM_ROWS / 1024 / 1024 / 0.9) RECOVER_MB
  FROM dba_tables A
 WHERE /*tablespace_name = 'PSAPSR3'
   AND*/
 A.BLOCKS * 8 / 1024 - A.AVG_ROW_LEN * A.NUM_ROWS / 1024 / 1024 / 0.9 > 100
/*AND rownum < 11*/
 AND A.TABLE_NAME = 'LIKP'
 order by RECOVER_MB desc;

--2.
--LIKP
ALTER TABLE ODSHAPPIGO.LIKP MOVE TABLESPACE EXDATA PARALLEL(DEGREE 4) NOLOGGING;
ALTER INDEX ODSHAPPIGO.PK_LIKP REBUILD PARALLEL(DEGREE 4) NOLOGGING;
ALTER INDEX ODSHAPPIGO.PK_LIKP NOPARALLEL;
--LIKP
ALTER TABLE ODSHAPPIGO.LIKP MOVE TABLESPACE DB_LOGISTICS PARALLEL(DEGREE 4) NOLOGGING;
ALTER INDEX ODSHAPPIGO.PK_LIKP REBUILD PARALLEL(DEGREE 4) NOLOGGING;
ALTER INDEX ODSHAPPIGO.PK_LIKP NOPARALLEL;

--3.
BEGIN
  DBMS_STATS.GATHER_TABLE_STATS(OWNNAME => 'ODSHAPPIGO',
                                TABNAME => 'LIKP',
                                DEGREE  => 4,
                                CASCADE => TRUE);
END;

DECLARE
  TYPE TYPE_RECORD IS RECORD(
    CRM_OBJ_ID VARCHAR2(10));

  TYPE TYPE_TABLE IS TABLE OF TYPE_RECORD INDEX BY BINARY_INTEGER; --类似二维数组 

  VAR_ARRAY TYPE_TABLE;
BEGIN
  /*逐条取出*/
  SELECT A.CRM_OBJ_ID
    BULK COLLECT
    INTO VAR_ARRAY
    FROM YANGJIN.ORDER_FROM_TMP A
   WHERE A.ZCRMD018 IS NOT NULL
     AND A.IS_UPDATE IS NULL
     AND ROWNUM <= 100;
  DBMS_OUTPUT.put_line(VAR_ARRAY.COUNT);
  FOR I IN 1 .. VAR_ARRAY.COUNT LOOP
  
    /*更新*/
    UPDATE FACT_GOODS_SALES A
       SET A.ORDER_FROM =
           (SELECT C.ZCRMD018
              FROM YANGJIN.ORDER_FROM_TMP C
             WHERE A.ORDER_KEY = C.CRM_OBJ_ID)
     WHERE A.ORDER_FROM IS NULL
       AND EXISTS (SELECT 1
              FROM YANGJIN.ORDER_FROM_TMP D
             WHERE A.ORDER_KEY = D.CRM_OBJ_ID)
       AND A.ORDER_KEY = VAR_ARRAY(I).CRM_OBJ_ID;
    COMMIT;
  
    UPDATE FACT_ORDER A
       SET A.ORDER_FROM =
           (SELECT C.ZCRMD018
              FROM YANGJIN.ORDER_FROM_TMP C
             WHERE A.ORDER_KEY = C.CRM_OBJ_ID)
     WHERE A.ORDER_FROM IS NULL
       AND EXISTS (SELECT 1
              FROM YANGJIN.ORDER_FROM_TMP D
             WHERE A.ORDER_KEY = D.CRM_OBJ_ID)
       AND A.ORDER_KEY = VAR_ARRAY(I).CRM_OBJ_ID;
    COMMIT;
  
    /*更新标志*/
    UPDATE YANGJIN.ORDER_FROM_TMP A
       SET A.IS_UPDATE = 1
     WHERE A.CRM_OBJ_ID = VAR_ARRAY(I).CRM_OBJ_ID;
    COMMIT;
  
  END LOOP;
END;

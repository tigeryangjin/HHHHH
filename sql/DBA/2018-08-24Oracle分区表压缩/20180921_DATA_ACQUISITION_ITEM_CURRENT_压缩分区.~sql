--1.
SELECT SUM(A.BYTES) / 1024 / 1024 / 1024 GB, SUM(A.BLOCKS) BLOCKS
  FROM DBA_SEGMENTS A
 WHERE A.OWNER = 'DW_USER'
   AND A.SEGMENT_NAME = 'DATA_ACQUISITION_ITEM_CURRENT';

SELECT *
  FROM DBA_TABLES A
 WHERE A.OWNER = 'DW_USER'
   AND A.TABLE_NAME = 'DATA_ACQUISITION_ITEM_CURRENT';

SELECT *
  FROM DBA_PART_TABLES A
 WHERE A.OWNER = 'DW_USER'
   AND A.TABLE_NAME = 'DATA_ACQUISITION_ITEM_CURRENT';

--2.
SELECT 'ALTER TABLE ' || A.TABLE_NAME || ' MOVE PARTITION ' ||
       A.PARTITION_NAME || ' COMPRESS PARALLEL 4;' S
  FROM DBA_TAB_PARTITIONS A
 WHERE A.TABLE_NAME = 'DATA_ACQUISITION_ITEM_CURRENT'
   --AND A.PARTITION_NAME IN ('VR1', 'VR2', 'VR3')
 ORDER BY A.PARTITION_NAME, A.PARTITION_NAME;
--3.重建分区索引
ALTER INDEX DATA_ACQUISITION_ITEM_CUR_PK REBUILD;

SELECT 'ALTER INDEX ' || A.INDEX_NAME || ' REBUILD PARTITION ' ||
       A.PARTITION_NAME || ';' S
  FROM USER_IND_PARTITIONS A
 WHERE A.INDEX_NAME = 'DATA_ACQUISITION_CUR_I1';
--4.
BEGIN
  DBMS_STATS.GATHER_TABLE_STATS(OWNNAME => 'DW_USER',
                                TABNAME => 'DATA_ACQUISITION_ITEM_BASE',
                                DEGREE  => 4,
                                CASCADE => TRUE);
END;
/

--tmp
  SELECT 963840 * 8 / 1024 / 1024 FROM DUAL;
	
	
SELECT 'ALTER INDEX DATA_ACQUISITION_ITEM_BASE_I1 REBUILD PARTITION ' ||
       A.PARTITION_NAME S
  FROM DBA_SEGMENTS A
 WHERE A.OWNER = 'DW_USER'
   AND A.SEGMENT_NAME = 'DATA_ACQUISITION_ITEM_BASE'
 ORDER BY A.PARTITION_NAME;

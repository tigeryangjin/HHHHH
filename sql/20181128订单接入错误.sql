--正式处理 
--1.
DROP TABLE YANGJIN.OD_ORDER_ITEM_TMP;
CREATE TABLE YANGJIN.OD_ORDER_ITEM_TMP AS 
SELECT A.ORDER_NO,
       A.ORDER_GROUP_SEQ,
       A.ORDER_SEQ,
       LPAD(A.ORDER_SEQ, 10, '0') OLD_ORDER_SEQ,
       LPAD(LPAD(A.ORDER_GROUP_SEQ, 3, '0') || '0' ||
            LPAD(A.ORDER_SEQ, 3, '0'),
            10,
            '0') NEW_ORDER_SEQ
  FROM OD_ORDER_ITEM A;

--2.
CREATE TABLE SAP_BIC_AZTCRD00100_BAK AS
SELECT * FROM SAP_BIC_AZTCRD00100 A;


--3.add column CRM_NUMINT2

--4.
UPDATE SAP_BIC_AZTCRD00100 A
   SET A.CRM_NUMINT2 =
       (SELECT MIN(B.NEW_ORDER_SEQ)
          FROM YANGJIN.OD_ORDER_ITEM_TMP B
         WHERE A.CRM_OHGUID = B.ORDER_NO
           AND A.CRM_NUMINT = B.OLD_ORDER_SEQ)
 WHERE EXISTS (SELECT 1
          FROM YANGJIN.OD_ORDER_ITEM_TMP C
         WHERE A.CRM_OHGUID = C.ORDER_NO
           AND A.CRM_NUMINT = C.OLD_ORDER_SEQ);

--4.
UPDATE SAP_BIC_AZTCRD00100 A
   SET A.CRM_NUMINT = A.CRM_NUMINT2
 WHERE A.CRM_NUMINT2 IS NOT NULL;
COMMIT;

--tmp
SELECT * FROM OPER_PRODUCT_DAILY_REPORT A WHERE A.POSTING_DATE_KEY=20181127;
SELECT * FROM YANGJIN.OD_ORDER_ITEM_TMP;
select * from SAP_BIC_AZTCRD00100;
select * from SAP_BIC_AZTCRD00100_MODIFY_TP t;

select MIN(A.CRM_NUMINT), MAX(A.CRM_NUMINT) from SAP_BIC_AZTCRD00100 A;

SELECT * FROM SAP_BIC_AZTCRD00100 A WHERE A.CRM_NUMINT='0000000000';

SELECT A.ORDER_NO, A.ORDER_GROUP_SEQ, A.ORDER_SEQ, COUNT(1)
  FROM YANGJIN.OD_ORDER_ITEM_TMP A
 GROUP BY A.ORDER_NO, A.ORDER_GROUP_SEQ, A.ORDER_SEQ
HAVING COUNT(1) > 1;

SELECT *
  FROM YANGJIN.OD_ORDER_ITEM_TMP A
 WHERE A.ORDER_NO = 20181126174589
   AND A.OLD_ORDER_SEQ = '0000000927';

select A.CRM_OBJ_ID, A.CRM_NUMINT, COUNT(1)
  from SAP_BIC_AZTCRD00100_MODIFY_TP A
 GROUP BY A.CRM_OBJ_ID, A.CRM_NUMINT
HAVING COUNT(1) > 1;





SELECT *
  FROM SAP_BIC_AZTCRD00100_MODIFY_TP A
 WHERE A.CRM_OBJ_ID = 5211534650
   AND A.CRM_NUMINT = 0000000475;

SELECT *
  FROM SAP_BIC_AZTCRD00100_MODIFY_TP A
 WHERE A.CRM_OBJ_ID = 5211538007
   AND A.CRM_NUMINT = 0000000927;

SELECT *
  FROM SAP_BIC_AZTCRD00100_MODIFY_TP A
 WHERE A.CRM_OBJ_ID = 5211538007
   AND A.CRM_NUMINT = 0000000926;

SELECT *
  FROM SAP_BIC_AZTCRD00100_MODIFY_TP A
 WHERE A.CRM_OBJ_ID = 5211534650
   AND A.CRM_NUMINT = 0000000474;

---	 
SELECT *
  FROM ODSHAPPIGO.OD_ORDER_ITEM B
 WHERE NVL(B.ECC_ORDER_NO, B.CRM_ORDER_NO) = 5211534650
   AND LPAD(B.ORDER_SEQ, 10, '0') = '0000000475';
	 
SELECT *
  FROM ODSHAPPIGO.OD_ORDER_ITEM B
 WHERE NVL(B.ECC_ORDER_NO, B.CRM_ORDER_NO) = 5211538007
   AND LPAD(B.ORDER_SEQ, 10, '0') = '0000000927';
	 
SELECT *
  FROM ODSHAPPIGO.OD_ORDER_ITEM B
 WHERE NVL(B.ECC_ORDER_NO, B.CRM_ORDER_NO) = 5211538007
   AND LPAD(B.ORDER_SEQ, 10, '0') = '0000000926';
	 
SELECT *
  FROM ODSHAPPIGO.OD_ORDER_ITEM B
 WHERE NVL(B.ECC_ORDER_NO, B.CRM_ORDER_NO) = 5211534650
   AND LPAD(B.ORDER_SEQ, 10, '0') = '0000000474';
	 
------
SELECT NVL(B.ECC_ORDER_NO, B.CRM_ORDER_NO) OBJECT_ID,
       B.ORDER_SEQ,
       COUNT(1)
  FROM ODSHAPPIGO.OD_ORDER_ITEM B
 GROUP BY NVL(B.ECC_ORDER_NO, B.CRM_ORDER_NO), B.ORDER_SEQ
HAVING COUNT(1) > 1;

SELECT * FROM  ODSHAPPIGO.OD_ORDER_ITEM B WHERE B.ECC_ORDER_NO=5211534650;

SELECT MAX(A.ORDER_SEQ),MAX(A.ORDER_GROUP_SEQ) FROM ODSHAPPIGO.OD_ORDER_ITEM A;

SELECT COUNT(1) FROM SAP_BIC_AZTCRD00100;

---------------------------
SELECT * FROM SAP_BIC_AZTCRD00100 A WHERE A.CRM_OHGUID = 20181022089836;
SELECT * FROM OD_ORDER_ITEM A WHERE A.ORDER_NO = 20181022089836;


 SELECT A.CRM_ITMGUI, COUNT(1)
   FROM SAP_BIC_AZTCRD00100 A
  GROUP BY A.CRM_ITMGUI
 HAVING COUNT(1) > 1;
 
SELECT A.ORDER_NO, A.ORDER_GB, A.ORDER_SEQ, COUNT(1)
  FROM OD_ORDER_ITEM A
 GROUP BY A.ORDER_NO, A.ORDER_GB, A.ORDER_SEQ
HAVING COUNT(1) > 1;

SELECT * FROM OD_ORDER_ITEM A WHERE A.ORDER_NO=20181024053834 AND A.ORDER_SEQ=3;
SELECT * FROM SAP_BIC_AZTCRD00100 A WHERE A.CRM_OHGUID=20181024053834 AND A.CRM_NUMINT='0000000003';

SELECT A.CRM_OHGUID, A.CRM_NUMINT
  FROM SAP_BIC_AZTCRD00100 A
 WHERE A.CRM_OHGUID = 20181022089836;
 
 
SELECT A.ORDER_NO,
       A.ORDER_GROUP_SEQ,
       A.ORDER_SEQ,
       LPAD(A.ORDER_SEQ, 10, '0') OLD_ORDER_SEQ,
       LPAD(LPAD(A.ORDER_GROUP_SEQ, 3, '0') || '0' ||
            LPAD(A.ORDER_SEQ, 3, '0'),
            10,
            '0') NEW_ORDER_SEQ
  FROM OD_ORDER_ITEM A
 WHERE A.ORDER_NO = 20181022089836;

CREATE TABLE YANGJIN.OD_ORDER_ITEM_TMP AS 
SELECT A.ORDER_NO,
       A.ORDER_GROUP_SEQ,
       A.ORDER_SEQ,
       LPAD(A.ORDER_SEQ, 10, '0') OLD_ORDER_SEQ,
       LPAD(LPAD(A.ORDER_GROUP_SEQ, 3, '0') || '0' ||
            LPAD(A.ORDER_SEQ, 3, '0'),
            10,
            '0') NEW_ORDER_SEQ
  FROM OD_ORDER_ITEM A;





DECLARE
  JSONARRAY               JSON_LIST; /*定义JSON数组*/
  ROW_FACT_GOODS_EVALUATE FACT_GOODS_EVALUATE%ROWTYPE;
  /*定义二维数组*/
  TYPE TYPE_RECORD IS RECORD(
    GEVAL_ID NUMBER(20));
  TYPE TYPE_TABLE IS TABLE OF TYPE_RECORD INDEX BY BINARY_INTEGER;
  ROW_GEVAL_ID TYPE_TABLE;
BEGIN
  /*插入二维数组*/
  SELECT A.GEVAL_ID
    BULK COLLECT
    INTO ROW_GEVAL_ID
    FROM FACT_GOODS_EVALUATE A
   WHERE A.GEVAL_SENTIMENT_POLARITY <> 0
     AND A.GEVAL_SENTIMENT_POLARITY_IASPE IS NOT NULL
     AND A.GEVAL_SENTIMENT_POLARITY_IASPE LIKE '%}]'
     AND NOT EXISTS (SELECT 1
            FROM FACT_GOODS_EVALUATE_ASPECT B
           WHERE A.GEVAL_ID = B.GEVAL_ID)
     AND A.GEVAL_ID BETWEEN 250000 AND 269000;
		 
  FOR I IN 1 .. ROW_GEVAL_ID.COUNT LOOP
    BEGIN
      SELECT A.GEVAL_ID,
             A.GEVAL_ORDERGOODSID,
             A.GEVAL_GOODS_COMMONID,
             A.GEVAL_SENTIMENT_POLARITY_IASPE
        INTO ROW_FACT_GOODS_EVALUATE.GEVAL_ID,
             ROW_FACT_GOODS_EVALUATE.GEVAL_ORDERGOODSID,
             ROW_FACT_GOODS_EVALUATE.GEVAL_GOODS_COMMONID,
             ROW_FACT_GOODS_EVALUATE.GEVAL_SENTIMENT_POLARITY_IASPE
        FROM FACT_GOODS_EVALUATE A
       WHERE A.GEVAL_ID = 1138870;
      /*JSON传入*/
      JSONARRAY := JSON_LIST(ROW_FACT_GOODS_EVALUATE.GEVAL_SENTIMENT_POLARITY_IASPE);
      FOR I IN 1 .. JSONARRAY.COUNT LOOP
        /*循环*/
        DBMS_OUTPUT.PUT_LINE(JSON_EXT.GET_STRING(JSON(JSONARRAY.GET(I)),
                                                 'aspectCategory'));
        /*INSERT TABLE*/
        INSERT INTO FACT_GOODS_EVALUATE_ASPECT
          (ID_COL,
           GEVAL_ID,
           GEVAL_ORDERGOODSID,
           GEVAL_GOODS_COMMONID,
           ASPECT_CATEGORY,
           ASPECT_TERM,
           ASPECT_INDEX,
           ASPECT_POLARITY,
           OPINION_TERM,
           W_INSERT_DT,
           W_UPDATE_DT)
        VALUES
          (FACT_GOODS_EVALUATE_ASPECT_SEQ.NEXTVAL,
           ROW_FACT_GOODS_EVALUATE.GEVAL_ID,
           ROW_FACT_GOODS_EVALUATE.GEVAL_ORDERGOODSID,
           ROW_FACT_GOODS_EVALUATE.GEVAL_GOODS_COMMONID,
           JSON_EXT.GET_STRING(JSON(JSONARRAY.GET(I)), 'aspectCategory'),
           JSON_EXT.GET_STRING(JSON(JSONARRAY.GET(I)), 'aspectTerm'),
           JSON_EXT.GET_STRING(JSON(JSONARRAY.GET(I)), 'aspectIndex'),
           JSON_EXT.GET_STRING(JSON(JSONARRAY.GET(I)), 'aspectPolarity'),
           JSON_EXT.GET_STRING(JSON(JSONARRAY.GET(I)), 'opinionTerm'),
           SYSDATE,
           SYSDATE);
        COMMIT;
      END LOOP;
    END;
  END LOOP;
END;

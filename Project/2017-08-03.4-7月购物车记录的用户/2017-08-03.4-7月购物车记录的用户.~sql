--用户调取条件：4-7月购物车有过数码电器(40)、保健用品(53)、母婴用品(54)、家居厨房(45)记录的用户；
--tmp table 
DROP TABLE JIN_TMP;
CREATE TABLE JIN_TMP AS
SELECT /*+PARALLEL(16)*/ A.MEMBER_KEY, A.PAGE_VALUE
  FROM FACT_PAGE_VIEW A
 WHERE A.VISIT_DATE_KEY BETWEEN 20170401 AND 20170731 /*4到7月份*/
   AND A.PAGE_NAME IN ('good', 'Good')
   AND A.MEMBER_KEY <> 0;
	 
--	 
SELECT DISTINCT A.MEMBER_KEY
  FROM JIN_TMP A
 WHERE EXISTS (SELECT 1
          FROM (SELECT C.ITEM_CODE
                  FROM DIM_GOOD C
                 WHERE C.MATDL IN (40, 45, 53, 54)
                   AND C.CURRENT_FLG = 'Y') B
         WHERE A.PAGE_VALUE = B.ITEM_CODE)
   AND A.PAGE_VALUE =
       TRANSLATE(A.PAGE_VALUE,
                 '0' || TRANSLATE(A.PAGE_VALUE, '#0123456789', '#'),
                 '0')
 ORDER BY 1;

--
SELECT DISTINCT A.MATDL,A.MATDLT,A.MATZL,A.MATZLT,A.MATXL,A.MATXLT
FROM DIM_GOOD A
ORDER BY 1,3,5;

SELECT DISTINCT A.MATDL,A.MATDLT,A.MATZL,A.MATZLT,A.MATXL,A.MATXLT
FROM DIM_MATERCATE A
WHERE A.MATZLT LIKE '%家居%'
ORDER BY 1,3,5;


--1.27.dw_user
CREATE MATERIALIZED VIEW LOG ON GOODS_LABEL_LINK  WITH PRIMARY KEY;  

--2.18.ml
CREATE MATERIALIZED VIEW ML.GOODS_LABEL_LINK_MV 
(ITEM_CODE,
 G_LABEL_ID,
 G_LABEL_TYPE_ID,
 CREATE_DATE,
 CREATE_USER_ID,
 LAST_UPDATE_DATE,
 LAST_UPDATE_USER_ID,
 ROW_ID) 
REFRESH FAST ON DEMAND    
WITH PRIMARY KEY                
AS 
SELECT ITEM_CODE,
       G_LABEL_ID,
       G_LABEL_TYPE_ID,
       CREATE_DATE,
       CREATE_USER_ID,
       LAST_UPDATE_DATE,
       LAST_UPDATE_USER_ID,
       ROW_ID
  FROM DW_USER.GOODS_LABEL_LINK@DW27;


--3.
CALL DBMS_MVIEW.REFRESH('GOODS_LABEL_LINK_MV',METHOD=>'FAST');

--4.
CREATE OR REPLACE VIEW ML.GOODS_LABEL_HEAD_V AS
SELECT A.G_LABEL_ID,
       A.G_LABEL_NAME,
       A.G_LABEL_DESC,
       A.G_LABEL_TYPE_ID,
       A.IS_LEAF_NODE,
       A.CREATE_DATE,
       A.CREATE_USER_ID,
       A.LAST_UPDATE_DATE,
       A.LAST_UPDATE_USER_ID,
       A.CURRENT_FLAG,
       A.G_LABEL_FATHER_ID
  FROM ML.GOODS_LABEL_HEAD A;

CREATE OR REPLACE VIEW ML.GOODS_LABEL_LINK_V AS
SELECT A.ITEM_CODE,
       A.G_LABEL_ID,
       A.G_LABEL_TYPE_ID,
       A.CREATE_DATE,
       A.CREATE_USER_ID,
       A.LAST_UPDATE_DATE,
       A.LAST_UPDATE_USER_ID,
       A.ROW_ID
  FROM ML.GOODS_LABEL_LINK_MV A;

--5.
-- Create sequence 
create sequence GOODS_FILTER_OPTION_HEAD_SEQ
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
cache 2;


--tmp
SELECT * FROM GOODS_LABEL_HEAD;
SELECT * FROM MEMBER_LABEL_HEAD;
SELECT * FROM GOODS_LABEL_LINK_V;
SELECT * FROM GOODS_LABEL_TYPE;
SELECT * FROM MEMBER_FILTER_OPTION_HEAD;
SELECT * FROM GOODS_FILTER_OPTION_HEAD;

SELECT *
  FROM GOODS_LABEL_HEAD A
 WHERE A.G_LABEL_NAME = 'GOODS_BASIC_ATTRIBUTE';
 
SELECT * FROM GOODS_LABEL_HEAD FOR UPDATE;

SELECT * FROM S_PARAMETERS2 FOR UPDATE;
SELECT * FROM W_ETL_LOG A ORDER BY A.START_TIME DESC;



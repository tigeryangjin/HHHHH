--无品牌商品的订购人数排名
SELECT D.MATDL,
       D.MATDLT,
       D.BRAND_NAME,
       D.ITEM_CODE,
       D.GOODS_NAME,
       COUNT(DISTINCT C.MEMBER_KEY) NUM_OF_MEMBER,
       SUM(C.NUMS) ORDER_QTY,
       SUM(C.ORDER_AMOUNT) ORDER_AMOUNT,
       DECODE(SUM(C.NUMS), 0, 0, SUM(C.ORDER_AMOUNT) / SUM(C.NUMS)) UNIT_PRICE
  FROM (SELECT A.GOODS_COMMON_KEY,
               A.UNIT_PRICE,
               A.ORDER_AMOUNT,
               A.NUMS,
               A.MEMBER_KEY
          FROM FACT_GOODS_SALES A
         WHERE A.POSTING_DATE_KEY BETWEEN 20160101 AND 20170719) C,
       (SELECT DISTINCT B.GOODS_COMMONID,
                        B.ITEM_CODE,
                        B.GOODS_NAME,
                        B.MATDL,
                        B.MATDLT,
                        NVL(B.BRAND_NAME, '无品牌') BRAND_NAME
          FROM DIM_GOOD B) D
 WHERE C.GOODS_COMMON_KEY = D.ITEM_CODE
   AND D.BRAND_NAME = '无品牌'
 GROUP BY D.MATDL, D.MATDLT, D.BRAND_NAME, D.ITEM_CODE, D.GOODS_NAME
 ORDER BY COUNT(DISTINCT C.MEMBER_KEY) DESC;
